<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gửi Người Đặc Biệt - Happy Birthday</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. RESET & GLOBAL STYLES
           ========================================= */
        :root {
            --primary: #d4af37; /* Màu vàng kim */
            --secondary: #c41e3a; /* Màu đỏ nhung */
            --bg-dark: #090909;
            --text-glow: 0 0 10px rgba(212, 175, 55, 0.7);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden; /* Không thanh cuộn */
            height: 100vh;
            perspective: 1000px;
        }

        /* Canvas Pháo Hoa Nền */
        #fireworks-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
        }

        /* =========================================
           2. CẢNH 1: HỘP QUÀ 3D (GIFT BOX)
           ========================================= */
        #scene-gift {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 1s, transform 1s;
        }

        .gift-container {
            position: relative;
            width: 150px;
            height: 150px;
            transform-style: preserve-3d;
            cursor: pointer;
            animation: floatBox 3s ease-in-out infinite;
        }

        .gift-container:hover {
            animation: shakeBox 0.5s infinite;
        }

        .gift-box {
            position: absolute;
            width: 100%; height: 100%;
            transform-style: preserve-3d;
            transform: rotateX(-20deg) rotateY(45deg);
            transition: transform 1s;
        }

        /* Các mặt của hộp */
        .face {
            position: absolute;
            width: 150px; height: 150px;
            background: var(--secondary);
            border: 2px solid #a0112b;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        /* Dây ruy băng */
        .face::before {
            content: ''; position: absolute;
            width: 30px; height: 100%;
            left: 50%; transform: translateX(-50%);
            background: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }
        .face::after {
            content: ''; position: absolute;
            width: 100%; height: 30px;
            top: 50%; transform: translateY(-50%);
            background: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }

        .front  { transform: translateZ(75px); }
        .back   { transform: rotateY(180deg) translateZ(75px); }
        .right  { transform: rotateY(90deg) translateZ(75px); }
        .left   { transform: rotateY(-90deg) translateZ(75px); }
        .bottom { transform: rotateX(-90deg) translateZ(75px); }
        
        /* Nắp hộp */
        .lid {
            position: absolute;
            width: 160px; height: 160px;
            background: var(--secondary);
            top: -5px; left: -5px;
            transform: rotateX(90deg) translateZ(75px);
            transform-style: preserve-3d;
            transition: transform 1s ease-in-out;
            transform-origin: top; /* Mở kiểu lật lên */
            z-index: 100;
            border: 2px solid var(--primary);
        }
        .lid-face {
            width: 100%; height: 100%; background: var(--secondary);
            display: flex; justify-content: center; align-items: center;
        }
        /* Nơ trên nắp */
        .bow {
            position: absolute;
            top: -40px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 40px;
        }
        .bow span {
            position: absolute; width: 40px; height: 40px;
            border-radius: 50%; border: 5px solid var(--primary);
            top: 0;
        }
        .bow span:nth-child(1) { left: 0; transform: skew(20deg); }
        .bow span:nth-child(2) { right: 0; transform: skew(-20deg); }

        /* Animation Hộp */
        @keyframes floatBox {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes shakeBox {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        .click-hint {
            position: absolute;
            bottom: -50px;
            width: 200px;
            text-align: center;
            color: var(--primary);
            font-size: 14px;
            animation: blink 1s infinite;
        }

        /* =========================================
           3. CẢNH 2: BỨC THƯ (LETTER)
           ========================================= */
        #scene-letter {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 90%; max-width: 600px;
            background: rgba(20, 20, 20, 0.95);
            border: 2px solid var(--primary);
            padding: 40px;
            z-index: 20;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.2);
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.27);
            opacity: 0;
            pointer-events: none; /* Khóa khi chưa hiện */
        }
        
        .letter-content {
            color: #eee;
            font-size: 18px;
            line-height: 1.6;
            min-height: 200px;
            font-family: 'Dancing Script', cursive; /* Font chữ viết tay */
            font-size: 24px;
        }

        .letter-cursor {
            display: inline-block;
            width: 2px; height: 20px;
            background: var(--primary);
            animation: blink 1s infinite;
        }

        #start-btn-container {
            text-align: center;
            margin-top: 30px;
            opacity: 0;
            transition: opacity 1s;
        }

        .btn-start {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 15px 40px;
            font-size: 20px;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-start:hover {
            background: var(--primary);
            color: #000;
            box-shadow: 0 0 20px var(--primary);
        }

        /* =========================================
           4. CẢNH 3: GALLERY ẢNH (LẢO ĐẢO BAY LÊN)
           ========================================= */
        #scene-gallery {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; /* Dưới hộp quà nhưng trên nền */
            pointer-events: none;
            overflow: hidden;
        }

        .photo-card {
            position: absolute;
            bottom: -30vh; /* Bắt đầu tít dưới màn hình */
            width: 150px; /* Kích thước ảnh */
            padding: 5px;
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transform-origin: center;
            opacity: 0;
            will-change: transform, opacity;
        }

        .photo-card img {
            width: 100%;
            display: block;
        }

        /* Hiệu ứng bay lên lảo đảo */
        /* Chúng ta sẽ tạo animation này bằng JS để random từng ảnh */

        @keyframes blink { 50% { opacity: 0; } }

        .hidden { display: none !important; }

    </style>
</head>
<body>

    <canvas id="fireworks-canvas"></canvas>

    <div id="scene-gift">
        <div class="gift-container" onclick="openGift()">
            <div class="gift-box">
                <div class="face front"></div>
                <div class="face back"></div>
                <div class="face right"></div>
                <div class="face left"></div>
                <div class="face bottom"></div>
                <div class="lid" id="gift-lid">
                    <div class="lid-face">
                        <div class="bow"><span></span><span></span></div>
                    </div>
                </div>
            </div>
            <div class="click-hint">CLICK ĐỂ MỞ QUÀ</div>
        </div>
    </div>

    <div id="scene-letter">
        <div class="letter-content">
            <span id="typewriter-text"></span><span class="letter-cursor">|</span>
        </div>
        <div id="start-btn-container">
            <button class="btn-start" onclick="startParty()">BẮT ĐẦU BỮA TIỆC</button>
        </div>
    </div>

    <div id="scene-gallery"></div>

    <script>
        // ===============================================
        // CẤU HÌNH DỮ LIỆU CỦA BẠN (SỬA Ở ĐÂY)
        // ===============================================
        const CONFIG = {
            // Lời chúc sinh nhật (dùng \n để xuống dòng)
            message: "Chào bạn,\n\nHôm nay là một ngày vô cùng đặc biệt. Một ngày mà thế giới đón chào một người tuyệt vời như bạn.\n\nChúc bạn tuổi mới luôn rực rỡ như pháo hoa, mạnh mẽ và tự do bay cao như những cánh chim. \n\nHãy bấm nút bên dưới để xem điều kỳ diệu nhé! ❤️",
            
            // Danh sách ảnh (Thay link ảnh của bạn vào)
            photos: [
                "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=300",
                "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=300",
                "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=300",
                "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=300",
                "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=300",
                "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300",
                // ... Thêm bao nhiêu ảnh tùy thích
            ]
        };

        // ===============================================
        // LOGIC 1: PHÁO HOA LIÊN TỤC (CANVAS)
        // ===============================================
        const canvas = document.getElementById('fireworks-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const particles = [];
        const fireworks = [];

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.velocity = { x: (Math.random() - 0.5) * 8, y: (Math.random() - 0.5) * 8 };
                this.alpha = 1;
                this.friction = 0.96;
            }
            draw() {
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.01;
            }
        }

        class Firework {
            constructor(x, y, targetX, targetY) {
                this.x = x; this.y = y;
                this.targetX = targetX; this.targetY = targetY;
                this.speed = 4;
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.velocity = { x: Math.cos(this.angle) * this.speed, y: Math.sin(this.angle) * this.speed };
                this.hue = Math.random() * 360;
            }
            draw() {
                ctx.globalAlpha = 1;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
                ctx.fill();
            }
            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                const dist = Math.hypot(this.x - this.targetX, this.y - this.targetY);
                if (dist < 10) {
                    // Explode
                    for (let i = 0; i < 50; i++) {
                        particles.push(new Particle(this.x, this.y, `hsl(${this.hue}, 100%, 50%)`));
                    }
                    return true; // Dead
                }
                return false;
            }
        }

        function animateFireworks() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            // Tự động bắn
            if (Math.random() < 0.05) {
                const startX = width / 2;
                const startY = height;
                const targetX = Math.random() * width;
                const targetY = Math.random() * height * 0.6;
                fireworks.push(new Firework(startX, startY, targetX, targetY));
            }

            fireworks.forEach((fw, index) => {
                fw.draw();
                if (fw.update()) fireworks.splice(index, 1);
            });

            particles.forEach((p, index) => {
                p.draw();
                p.update();
                if (p.alpha <= 0) particles.splice(index, 1);
            });
            requestAnimationFrame(animateFireworks);
        }
        animateFireworks();

        // ===============================================
        // LOGIC 2: HỘP QUÀ & MỞ HỘP
        // ===============================================
        let isGiftOpened = false;
        function openGift() {
            if (isGiftOpened) return;
            isGiftOpened = true;

            // 1. Mở nắp hộp
            const lid = document.getElementById('gift-lid');
            lid.style.transform = "rotateX(200deg) translateZ(75px)"; // Lật hẳn ra sau

            // 2. Ẩn gợi ý
            document.querySelector('.click-hint').style.display = 'none';

            // 3. Sau 1s, Phóng to hộp rồi biến mất, hiện thư
            setTimeout(() => {
                const giftScene = document.getElementById('scene-gift');
                giftScene.style.opacity = '0';
                giftScene.style.transform = 'scale(2)'; // Hiệu ứng zoom vào rồi biến mất
                
                setTimeout(() => {
                    giftScene.style.display = 'none';
                    showLetter();
                }, 1000);
            }, 800);
            
            // Bật nhạc nếu có
            // document.getElementById('bg-music').play().catch(e => console.log("Cần tương tác để phát nhạc"));
        }

        // ===============================================
        // LOGIC 3: VIẾT THƯ (TYPEWRITER)
        // ===============================================
        function showLetter() {
            const letterScene = document.getElementById('scene-letter');
            letterScene.style.pointerEvents = 'auto';
            letterScene.style.opacity = '1';
            letterScene.style.transform = 'translate(-50%, -50%) scale(1)';

            let i = 0;
            const textElement = document.getElementById('typewriter-text');
            const speed = 50; // Tốc độ viết

            function typeWriter() {
                if (i < CONFIG.message.length) {
                    const char = CONFIG.message.charAt(i);
                    // Xử lý xuống dòng
                    if (char === '\n') {
                        textElement.innerHTML += '<br>';
                    } else {
                        textElement.innerHTML += char;
                    }
                    i++;
                    setTimeout(typeWriter, speed);
                } else {
                    // Viết xong -> Hiện nút Start
                    document.querySelector('.letter-cursor').style.display = 'none';
                    document.getElementById('start-btn-container').style.opacity = '1';
                }
            }
            // Chờ 1 chút rồi bắt đầu viết
            setTimeout(typeWriter, 1000);
        }

        // ===============================================
        // LOGIC 4: BỮA TIỆC ẢNH (LẢO ĐẢO BAY LÊN)
        // ===============================================
        function startParty() {
            // 1. Ẩn bức thư đi
            const letterScene = document.getElementById('scene-letter');
            letterScene.style.opacity = '0';
            letterScene.style.transform = 'translate(-50%, -50%) scale(2)'; // Zoom out biến mất
            setTimeout(() => { letterScene.style.display = 'none'; }, 1000);

            // 2. Bắt đầu thả ảnh
            startFloatingPhotos();
        }

        function startFloatingPhotos() {
            const container = document.getElementById('scene-gallery');
            
            // Cứ 0.8 giây tạo 1 ảnh mới
            setInterval(() => {
                createDriftingPhoto(container);
            }, 800);
        }

        function createDriftingPhoto(container) {
            // Tạo element
            const div = document.createElement('div');
            div.className = 'photo-card';
            
            const img = document.createElement('img');
            img.src = CONFIG.photos[Math.floor(Math.random() * CONFIG.photos.length)];
            div.appendChild(img);
            
            // --- Cấu hình Random Vật lý ---
            
            // 1. Vị trí xuất phát (ngang)
            const startLeft = Math.random() * 90 + 5; // 5% đến 95% màn hình
            div.style.left = startLeft + '%';

            // 2. Kích thước (To nhỏ khác nhau)
            const scale = Math.random() * 0.5 + 0.7; // 0.7 đến 1.2
            div.style.transform = `scale(${scale})`; // Set scale ban đầu

            // 3. Thời gian bay (Chậm nhanh khác nhau)
            const duration = Math.random() * 10 + 15; // 15s đến 25s (Rất chậm)

            // 4. Tạo Keyframes động cho từng ảnh để nó "lảo đảo" khác nhau
            // Chúng ta dùng Web Animations API để mượt mà hơn chèn style
            
            // Random hướng xoay (trái hay phải)
            const rotateEnd = (Math.random() - 0.5) * 720; // Xoay từ -360 đến 360 độ
            
            // Random độ lắc lư (sway) - Lảo đảo
            const swayAmount = (Math.random() - 0.5) * 200; // Lệch trái phải 100px

            // Animation Bay lên + Lắc lư + Xoay
            div.animate([
                { 
                    transform: `translateY(0) translateX(0) rotate(0deg) scale(${scale})`, 
                    opacity: 0,
                    bottom: '-30vh' 
                },
                { 
                    opacity: 1, 
                    offset: 0.1 
                },
                {
                    transform: `translateY(-60vh) translateX(${swayAmount}px) rotate(${rotateEnd / 2}deg) scale(${scale})`,
                    offset: 0.5 
                },
                { 
                    transform: `translateY(-130vh) translateX(0) rotate(${rotateEnd}deg) scale(${scale})`, 
                    opacity: 0,
                    bottom: '100vh' 
                }
            ], {
                duration: duration * 1000,
                easing: 'linear',
                fill: 'forwards'
            });

            container.appendChild(div);

            // Xóa ảnh sau khi bay xong để nhẹ máy
            setTimeout(() => {
                div.remove();
            }, duration * 1000);
        }

    </script>
</body>
</html>
